---
title: "Shell(进阶)"
date: 2026-01-16 
categories: [Computer science]
tags: [Computer science]
---

## Shell 脚本

很多情况下我们需要执行一系列的操作并使用条件或循环这样的控制流。大多数 shell 都有自己的一套脚本语言，包括变量、控制流和自己的语法。shell 脚本与其他脚本语言不同之处在于，shell 脚本针对 shell 所从事的相关工作进行了优化。因此，创建命令流程（pipelines）、将结果保存到文件、从标准输入中读取输入，这些都是 shell 脚本中的原生操作，这让它比通用的脚本语言更易用。本节中，我们会专注于 bash 脚本，因为它最流行，应用更为广泛。

```shell
foo=bar
#赋值语句
echo "$foo"
# 打印 bar
echo '$foo'
# 打印 $foo
```

* 变量赋值: `foo=bar`
* 访问变量中存储的数值: `$foo`。 

<span style="color: green;">注意⚠️</span>:  <span style="color: red;">`foo = bar` (使用空格隔开)是不能正确工作的，因为解释器会调用程序 `foo` 并将 `=` 和 `bar` 作为参数。</span>

**字符串** :Bash 中的字符串通过 `'` 和 `"` 分隔符来定义，但含义并不相同。

* <span style="color: red;">以 `'` 定义的字符串为原义字符串</span>，其中的变量不会被转义
* <span style="color: red;">而 `"` 定义的字符串会将变量值进行替换。</span>

### 控制流

`bash` 支持 `if`, `case`, `while` 和 `for` 这些控制流关键字和函数(它可以接受参数并基于参数进行操作)。

```shell
mcd () {
    mkdir -p "$1"
    cd "$1"
}
```

这里 `$1` 是脚本的第一个参数。与其他脚本语言不同的是，bash 使用了很多特殊的变量来表示参数、错误代码和相关变量。下面列举了其中一些变量，更完整的列表可以参考 [这里](https://www.tldp.org/LDP/abs/html/special-chars.html)。

- `$0` - 脚本名
- `$1` 到 `$9` - 脚本的参数。 `$1` 是第一个参数，依此类推。
- `$@` - 所有参数
- `$#` - 参数个数
- `$?` - 前一个命令的返回值
- `$$` - 当前脚本的进程识别码
- `!!` - 完整的上一条命令，包括参数。常见应用：当你因为权限不足执行命令失败时，可以使用 `sudo !!` 再尝试一次。
- `$_` - 上一条命令的最后一个参数。如果你正在使用的是交互式 shell，你可以通过按下 `Esc` 之后键入 . 来获取这个值。
